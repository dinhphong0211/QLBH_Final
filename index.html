<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√¨nh Qu·∫£n l√Ω ƒê∆°n H√†ng</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; text-align: center; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-4 md:p-8 rounded-xl shadow-lg w-full max-w-lg mb-20">
        
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800">
                üìù B√°o C√°o & Doanh Thu
            </h1>
            <button id="reset-btn" class="text-sm text-red-500 hover:text-red-700 underline font-medium">
                L√†m m·ªõi
            </button>
        </div>

        <!-- Khu v·ª±c nh·∫≠p li·ªáu -->
        <div class="mb-6">
            <div class="flex justify-between text-sm font-semibold text-gray-500 mb-2 px-2">
                <span>M·∫∑t h√†ng</span>
                <div class="flex gap-8 mr-2">
                    <span>Nh·∫≠n</span>
                    <span>Tr·∫£</span>
                </div>
            </div>
            <div id="item-list" class="space-y-3">
                <!-- JS ch√®n input v√†o ƒë√¢y -->
            </div>
        </div>

        <!-- Khu v·ª±c N√∫t b·∫•m -->
        <div class="flex flex-col gap-3 my-6">
            <!-- N√∫t T√≠nh to√°n (M√†u xanh) -->
            <button id="calculate-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 transition duration-200 text-lg flex items-center justify-center gap-2">
                <span>üí∞</span> T√≠nh To√°n & Th√†nh Ti·ªÅn
            </button>
            
            <!-- N√∫t Sao ch√©p (M√†u x√°m) -->
            <button id="copy-btn" class="w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-lg shadow-sm hover:bg-gray-300 transition duration-200 text-base flex items-center justify-center gap-2">
                <span>üìã</span> Sao ch√©p B√°o C√°o (Copy)
            </button>
        </div>

        <hr class="my-6 border-gray-200">

        <!-- Khu v·ª±c k·∫øt qu·∫£ -->
        <div>
            <h2 class="text-xl font-semibold text-gray-700 mb-4 flex justify-between items-end">
                <span>üì¶ K·∫øt Qu·∫£</span>
                <span id="total-revenue-small" class="text-blue-600 text-lg font-bold hidden">0 ‚Ç´</span>
            </h2>
            <div id="result-container">
                <ul id="order-summary" class="space-y-2">
                    <li class="text-gray-500 italic text-center text-sm">Nh·∫≠p s·ªë li·ªáu v√† nh·∫•n T√≠nh to√°n.</li>
                </ul>
            </div>

            <div id="total-section" class="mt-6 bg-gray-900 text-white p-4 rounded-lg shadow-lg hidden">
                <div class="flex justify-between items-center">
                    <span class="text-gray-300 font-medium">T·ªîNG DOANH THU</span>
                    <span id="total-revenue-large" class="text-2xl font-bold text-green-400">0 ‚Ç´</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Th√¥ng b√°o Copy th√†nh c√¥ng -->
    <div id="toast" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-80 text-white px-4 py-2 rounded-full text-sm hidden transition-opacity duration-300">
        ƒê√£ sao ch√©p v√†o b·ªô nh·ªõ t·∫°m!
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const items = ['V·ªè b√°nh', 'B√≤', 'T√¥m', 'G√†', 'X√∫c x√≠ch', 'Tr·ª©ng', 'Ph√¥ mai'];
            
            // Gi√° b√°n
            const recipes = [
                { name: 'Burger B√≤ Tr·ª©ng', price: 20000, ingredients: { 'V·ªè b√°nh': 1, 'B√≤': 1, 'Tr·ª©ng': 1 }, color: 'text-green-700', bgColor: 'bg-green-50' },
                { name: 'Burger B√≤', price: 18000, ingredients: { 'V·ªè b√°nh': 1, 'B√≤': 1 }, color: 'text-indigo-700', bgColor: 'bg-indigo-50' },
                { name: 'Burger T√¥m', price: 20000, ingredients: { 'V·ªè b√°nh': 1, 'T√¥m': 1 }, color: 'text-purple-700', bgColor: 'bg-purple-50' },
                { name: 'Burger G√†', price: 20000, ingredients: { 'V·ªè b√°nh': 1, 'G√†': 1 }, color: 'text-orange-700', bgColor: 'bg-orange-50' },
                { name: 'Burger X√∫c X√≠ch', price: 20000, ingredients: { 'V·ªè b√°nh': 1, 'X√∫c x√≠ch': 1 }, color: 'text-red-700', bgColor: 'bg-red-50' },
                { name: 'Burger Tr·ª©ng', price: 10000, ingredients: { 'V·ªè b√°nh': 1, 'Tr·ª©ng': 1 }, color: 'text-yellow-700', bgColor: 'bg-yellow-50' }
            ];

            const leftoverPrices = { 'V·ªè b√°nh': 8000, 'B√≤': 10000, 'T√¥m': 12000, 'G√†': 12000, 'X√∫c x√≠ch': 12000, 'Tr·ª©ng': 2000, 'Ph√¥ mai': 5000 };

            const itemList = document.getElementById('item-list');
            const summaryList = document.getElementById('order-summary');
            const calculateBtn = document.getElementById('calculate-btn');
            const copyBtn = document.getElementById('copy-btn'); // M·ªöI
            const resetBtn = document.getElementById('reset-btn');
            const totalSection = document.getElementById('total-section');
            const totalRevenueLarge = document.getElementById('total-revenue-large');
            const totalRevenueSmall = document.getElementById('total-revenue-small');
            const toast = document.getElementById('toast');

            const formatCurrency = (amount) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);

            // --- T·∫†O GIAO DI·ªÜN ---
            items.forEach(item => {
                const itemRow = document.createElement('div');
                itemRow.className = 'flex justify-between items-center bg-gray-50 p-2 rounded-lg border border-gray-100';
                const itemName = document.createElement('label');
                itemName.textContent = item;
                itemName.className = 'text-base text-gray-800 font-medium';
                const inputWrapper = document.createElement('div');
                inputWrapper.className = 'flex items-center gap-2';
                const id = item.replace(/\s+/g, '-');

                const createInput = (type, placeholder) => {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = '0';
                    input.id = `item-${type}-${id}`;
                    input.className = `quantity-input w-16 h-10 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-center font-semibold text-lg ${type === 'tra' ? 'text-red-600 bg-red-50' : 'text-blue-600 bg-white'}`;
                    input.placeholder = placeholder;
                    input.addEventListener('input', saveData);
                    return input;
                };

                inputWrapper.appendChild(createInput('nhan', '-'));
                inputWrapper.appendChild(createInput('tra', '-'));
                itemRow.appendChild(itemName);
                itemRow.appendChild(inputWrapper);
                itemList.appendChild(itemRow);
            });

            // --- L∆ØU & T·∫¢I ---
            function saveData() {
                const data = {};
                document.querySelectorAll('.quantity-input').forEach(input => { if (input.value) data[input.id] = input.value; });
                localStorage.setItem('burgerApp_data_v5', JSON.stringify(data));
            }

            function loadData() {
                const savedData = localStorage.getItem('burgerApp_data_v5');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    for (const [id, value] of Object.entries(data)) {
                        const input = document.getElementById(id);
                        if (input) input.value = value;
                    }
                    setTimeout(calculateAndDisplaySummary, 100); 
                }
            }

            // --- RESET ---
            resetBtn.addEventListener('click', () => {
                if(confirm('X√≥a h·∫øt d·ªØ li·ªáu?')) {
                    document.querySelectorAll('.quantity-input').forEach(input => input.value = '');
                    localStorage.removeItem('burgerApp_data_v5');
                    summaryList.innerHTML = '<li class="text-gray-500 italic text-center text-sm">ƒê√£ x√≥a d·ªØ li·ªáu.</li>';
                    totalSection.classList.add('hidden');
                    totalRevenueSmall.classList.add('hidden');
                }
            });

            // --- COPY FUNCTION (M·ªöI) ---
            copyBtn.addEventListener('click', () => {
                let textToCopy = "";

                // 1. Ph·∫ßn NH·∫¨N H√ÄNG
                textToCopy += "NH·∫¨N H√ÄNG\n";
                items.forEach(item => {
                    const id = item.replace(/\s+/g, '-');
                    const val = document.getElementById(`item-nhan-${id}`).value || "0";
                    textToCopy += `${item}: ${val}\n`;
                });

                textToCopy += "\n"; // D√≤ng tr·ªëng ngƒÉn c√°ch

                // 2. Ph·∫ßn TR·∫¢ H√ÄNG
                textToCopy += "TR·∫¢ H√ÄNG\n";
                items.forEach(item => {
                    const id = item.replace(/\s+/g, '-');
                    const val = document.getElementById(`item-tra-${id}`).value || "0";
                    textToCopy += `${item}: ${val}\n`;
                });

                // Th·ª±c hi·ªán Copy
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showToast();
                    }).catch(err => {
                        // Fallback n·∫øu l·ªói
                        alert("Kh√¥ng th·ªÉ t·ª± ƒë·ªông sao ch√©p. Vui l√≤ng ch·ªçn v√† sao ch√©p th·ªß c√¥ng:\n\n" + textToCopy);
                    });
                } else {
                    // Fallback cho tr√¨nh duy·ªát c≈©
                     const textarea = document.createElement('textarea');
                     textarea.value = textToCopy;
                     document.body.appendChild(textarea);
                     textarea.select();
                     document.execCommand('copy');
                     document.body.removeChild(textarea);
                     showToast();
                }
            });

            function showToast() {
                toast.classList.remove('hidden');
                setTimeout(() => toast.classList.add('hidden'), 2000);
            }

            // --- T√çNH TO√ÅN ---
            function calculateAndDisplaySummary() {
                summaryList.innerHTML = ''; 
                const quantities = {};
                let hasInput = false;
                let GRAND_TOTAL = 0;
                
                items.forEach(item => {
                    const id = item.replace(/\s+/g, '-');
                    const valNhan = parseInt(document.getElementById(`item-nhan-${id}`).value, 10) || 0;
                    const valTra = parseInt(document.getElementById(`item-tra-${id}`).value, 10) || 0;
                    if (valNhan > 0 || valTra > 0) hasInput = true;
                    quantities[item] = Math.max(0, valNhan - valTra);
                });

                if (!hasInput) {
                    summaryList.innerHTML = '<li class="text-gray-500 italic text-center text-sm">Ch∆∞a nh·∫≠p s·ªë li·ªáu.</li>';
                    totalSection.classList.add('hidden');
                    totalRevenueSmall.classList.add('hidden');
                    return;
                }

                const comboResults = {};
                let hasItems = false;

                recipes.forEach(recipe => {
                    let maxCombos = Infinity;
                    for (const ingredient in recipe.ingredients) {
                        const required = recipe.ingredients[ingredient];
                        const available = quantities[ingredient] || 0;
                        maxCombos = Math.min(maxCombos, Math.floor(available / required));
                    }
                    if (maxCombos === Infinity) maxCombos = 0;

                    if (maxCombos > 0) {
                        hasItems = true;
                        if (comboResults[recipe.name]) {
                             comboResults[recipe.name].amount += maxCombos;
                        } else {
                             comboResults[recipe.name] = { amount: maxCombos, ...recipe };
                        }
                        for (const ingredient in recipe.ingredients) {
                            quantities[ingredient] -= maxCombos * recipe.ingredients[ingredient];
                        }
                    }
                });

                for (const comboName in comboResults) {
                    const item = comboResults[comboName];
                    const totalItemPrice = item.amount * item.price;
                    GRAND_TOTAL += totalItemPrice;
                    appendSummaryItem(comboName, item.amount, totalItemPrice, item.color, item.bgColor);
                }

                for (const item in quantities) {
                    if (quantities[item] > 0) {
                        hasItems = true;
                        let label = item;
                        let isRecipeIngredient = false;
                        for(let r of recipes) { if(r.ingredients[item]) { isRecipeIngredient = true; break; } }
                        if (isRecipeIngredient) label += " (d∆∞)";
                        const pricePerUnit = leftoverPrices[item] || 0;
                        const totalItemPrice = quantities[item] * pricePerUnit;
                        GRAND_TOTAL += totalItemPrice;
                        appendSummaryItem(label, quantities[item], totalItemPrice, 'text-gray-700', 'bg-gray-100');
                    }
                }
                
                if (!hasItems) {
                    summaryList.innerHTML = '<li class="text-gray-500 italic text-center">Kh√¥ng b√°n ƒë∆∞·ª£c g√¨.</li>';
                }

                totalSection.classList.remove('hidden');
                totalRevenueSmall.classList.remove('hidden');
                totalRevenueLarge.textContent = formatCurrency(GRAND_TOTAL);
                totalRevenueSmall.textContent = formatCurrency(GRAND_TOTAL);
            }

            function appendSummaryItem(name, quantity, totalPrice, textColor, bgColor) {
                const li = document.createElement('li');
                li.className = `py-2 px-3 rounded-lg flex justify-between items-center border border-opacity-20 border-gray-400 ${bgColor}`;
                const leftDiv = document.createElement('div');
                leftDiv.className = 'flex flex-col';
                leftDiv.innerHTML = `<span class="font-bold ${textColor}">${name}</span><span class="text-xs text-gray-500">SL: ${quantity}</span>`;
                const rightSpan = document.createElement('span');
                rightSpan.className = `font-bold text-lg ${textColor}`;
                rightSpan.textContent = formatCurrency(totalPrice);
                li.appendChild(leftDiv);
                li.appendChild(rightSpan);
                summaryList.appendChild(li);
            }

            calculateBtn.addEventListener('click', calculateAndDisplaySummary);
            loadData();
        });
    </script>

    <!-- ƒêƒÉng k√Ω Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW v6 registered'))
                    .catch(err => console.log('SW failed', err));
            });
        }
    </script>
</body>
</html>


